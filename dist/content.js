let originalBodyClasses="";function applyOpenDyslexicFont(e){if(e){if(!document.getElementById("openDyslexicFont")){const e=document.createElement("link");e.id="openDyslexicFont",e.rel="stylesheet",e.href="https://fonts.cdnfonts.com/css/open-dyslexic",document.head.appendChild(e)}if(!document.getElementById("openDyslexicStyles")){const e=document.createElement("style");e.id="openDyslexicStyles",e.innerHTML="\n        * {\n          font-family: 'Open-Dyslexic', Arial, sans-serif !important;\n          font-weight: normal !important;\n        }\n        \n        /* Ensure the font is applied to dynamically created content */\n        .simplif-ai-summary, .simplif-ai-content {\n          font-family: 'Open-Dyslexic', Arial, sans-serif !important;\n        }\n      ",document.head.appendChild(e)}document.body.classList.add("open-dyslexic")}else{document.body.classList.remove("open-dyslexic");const e=document.getElementById("openDyslexicFont");e&&e.remove();const t=document.getElementById("openDyslexicStyles");t&&t.remove();const n=document.createElement("style");n.id="resetFontStyles",n.innerHTML="* { font-family: initial !important; }",document.head.appendChild(n),setTimeout((()=>{document.getElementById("resetFontStyles")?.remove()}),100)}}document.addEventListener("DOMContentLoaded",(()=>{originalBodyClasses=document.body.className,chrome.storage.sync.get(["darkMode","highContrast","openDyslexic"],(e=>{e.darkMode&&document.body.classList.add("dark-mode"),e.highContrast&&document.body.classList.add("high-contrast-mode"),e.openDyslexic&&applyOpenDyslexicFont(!0)}))})),chrome.runtime.onMessage.addListener(((e,t,n)=>{if("getParagraphs"===e.action){const e=Array.from(document.getElementsByTagName("p")).map((e=>e.innerText.trim())).filter((e=>e.length>0));if(0===e.length){const t=document.querySelector("article");if(t)e.push(t.innerText.trim());else{const t=document.querySelector("main");t?e.push(t.innerText.trim()):e.push(document.body.innerText.trim())}}n({paragraphs:e})}if("toggleOpenDyslexic"===e.action&&(applyOpenDyslexicFont(e.enable),n({status:"openDyslexicToggled",active:e.enable})),"speakText"===e.action){speechSynthesis.cancel();const t=new SpeechSynthesisUtterance(e.text);t.lang=e.lang||"en-US",t.rate=e.rate||1,t.pitch=e.pitch||1;const s=new SpeechSynthesisUtterance("Starting text-to-speech");s.volume=.3,speechSynthesis.speak(s),setTimeout((()=>{speechSynthesis.speak(t)}),500),n({status:"speaking"})}if("pauseSpeech"===e.action&&(speechSynthesis.pause(),n({status:"paused"})),"resumeSpeech"===e.action&&(speechSynthesis.resume(),n({status:"resumed"})),"stopSpeech"===e.action&&(speechSynthesis.cancel(),n({status:"stopped"})),"toggleDarkMode"===e.action){const e=document.body.classList.toggle("dark-mode");chrome.storage.sync.set({darkMode:e}),e&&document.body.classList.contains("high-contrast-mode")&&(document.body.classList.remove("high-contrast-mode"),chrome.storage.sync.set({highContrast:!1})),n({status:"darkModeToggled",active:e})}if("toggleHighContrast"===e.action){const e=document.body.classList.toggle("high-contrast-mode");chrome.storage.sync.set({highContrast:e}),e&&document.body.classList.contains("dark-mode")&&(document.body.classList.remove("dark-mode"),chrome.storage.sync.set({darkMode:!1})),n({status:"highContrastToggled",active:e})}return!0}));